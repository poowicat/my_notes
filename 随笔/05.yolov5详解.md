### 输入端

#### Mosaic数据增强

- Yolov4中开始使用；
- 参考：参考2019年底提出的CutMix数据增强的方式，但CutMix只是使用了两张图片进行拼接；
- 方式：Mosaic数据增强采用4张图片，进行随机缩放、随机建材、随机排布的方式进行拼接；
- 目的：小目标分布不均，小目标AP比中、大目标低很多；
- 优点：丰富数据集、减少GPU占用

#### 自适应描框计算

- 方式：将原始图片统一缩放到一个标准尺寸，再送入检测网络中；
- 步骤：
  - 计算缩放比例
  - 计算缩放后的尺寸
  - 计算黑边填充数值
- 注意：
  1. yolov5中填充的是灰色，即（114， 114， 114）
  2. 训练时没有采用 **缩减黑边**的方式，还是采用传统填充的方式，即缩放到416X416大小
  3. 测试时，使用**模型推理**时，才采用**缩减黑边**的方式。提高目标检测，推理速度
  4. 为什么np.mod函数后面用32？因为yolov5网络经过5此下采样，**2的五次方**等于32，所有至少要去掉32的倍数，在进行取余。



### Backbone

#### Focus结构

- 在yolov3/4中都没有这个结构。其比较关键的是 **切片操作**
- 4X4X3的图像切片后变成2X2X12的特征图:
- ![image-20220426133326872](../../%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/image-20220426133326872.png)
- 以**Yolov5s**的结构为例，原始**608×608×3**的图像输入**Focus结构，**采用**切片操作**，先变成**304×304×12**的特征图，再经过一次32个卷积核的卷积操作，最终变成**304×304×32**的特征图。![image-20220426133316186](../../%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/image-20220426133316186.png)

#### CSP结构

- **Yolov5**与**Yolov4****不同点**在于，**Yolov4**中只有**主干网络**使用了**CSP结构，**而**Yolov5**中设计了两种**CSP结构，**以**Yolov5s**网络为例，以**CSP1_X**结构应用于**Backbone主干网络**，另一种**CSP2_X**结构则应用于**Neck中**。



### Neck

- **Yolov5**现在的**Neck**和**Yolov4**中一样，都采用**FPN+PAN**的结构，但在**Yolov5**刚出来时，只使用了**FPN结构**，后面才增加了**PAN结构**，此外网络中其他部分也进行了调整。
- ![image-20220426143059335](../%E5%9B%BE%E7%89%87/image-20220426143059335.png)
- **Yolov4**的**Neck**中，采用的都是普通的卷积操作。
- 而**Yolov5**的**Neck结构**中，采用借鉴**CSPNet**设计的**CSP2结构**，**加强网络特征融合的能力**。



### 输出端

#### Bounding Box损失函数

- yolov5中采用进化版本的CIOU_Loss做Bounding box的损失函数
- ![在这里插入图片描述](../../%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25hbjM1NTY1NTYwMA==,size_16,color_FFFFFF,t_70%23pic_center.png)
- ![在这里插入图片描述](../../%E7%AC%94%E8%AE%B0/%E5%9B%BE%E7%89%87/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25hbjM1NTY1NTYwMA==,size_16,color_FFFFFF,t_70%23pic_center-16509549900756.png)



#### nms非极大值抑制

- 在目标检测后处理中，针对很多目标框的筛选，通常需要nms操作
- Yolov4在DIOU_Loss基础上采用DIOU_nms方式
- 而Yolov5仍然采用加权nms的方式
- 

